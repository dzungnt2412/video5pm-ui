(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["order"],{"00ca":function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.isFetching?r("PageDetailLoading"):r("div",{staticClass:"order-view-page page"},[r("div",{staticClass:"page-header"},[r("div",{staticClass:"container-fluid"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-12"},[r("p-button",{staticClass:"btn-pure pl-0",attrs:{icon:"chevron-left"}},[r("router-link",{attrs:{to:{name:"order-list"}}},[t._v("Đơn hàng")])],1)],1)])])]),r("div",{staticClass:"page-content"},[r("div",{staticClass:"container-fluid"},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-12"},[r("div",{staticClass:"d-flex align-items-center justify-content-between flex-wrap"},[r("div",{staticClass:"order-metadata d-flex align-items-center"},[r("h4",{staticClass:"order-number"},[t._v(t._s(t.order.ref_id))]),r("span",{staticClass:"order-date ml-10 mr-10"},[t._v(t._s(t._f("datetime")(t.order.created_at)))]),r("span",{directives:[{name:"status",rawName:"v-status:status",value:t.order.status,expression:"order.status",arg:"status"}]})]),r("div",{staticClass:"order-metadata d-flex align-items-center"},[t.isAllowCancel?r("p-button",{staticClass:"ml-10",attrs:{type:"danger"},on:{click:function(e){return t.confirmUpdateOrder("canceled")}}},[t._v("Cancel")]):t._e()],1)]),r("div",{staticClass:"row mt-15"},[r("div",{staticClass:"col-12 col-md-8"},[r("section",{staticClass:"card section-order-items"},[r("div",{staticClass:"card-block"},[r("div",{staticClass:"card-title d-flex align-items-center justify-content-between"},[r("h4",[t._v("Danh sách sản phẩm")]),r("p-tooltip",{attrs:{label:"Sửa sản phẩm",position:"top",type:"dark"}},[t.isAllowUpdateOrder(t.order)?r("p-button",{attrs:{icon:"pencil",type:"default",name:"pencil",size:"sm"},on:{click:t.toggleEditOrder}}):t._e()],1)],1),r("order-items",{attrs:{order:t.order,items:t.orderItems,editing:t.editing,designs:t.designs,"fetch-designs":t.fetchDesigns,"product-types":t.productTypes,"shop-id":t.order.shop_id,"is-allow-update":t.isAllowUpdateOrder(t.order)},on:{selectedProduct:t.handleSelectedProductType,selectedDesign:t.handleSelectedDesign}}),t.editing?r("div",{staticClass:"text-right mt-15"},[r("p-button",{attrs:{disabled:t.isUpdating},on:{click:function(e){return t.handleUpdateOrder(null)}}},[t._v("Update order")])],1):t._e()],1)])]),r("div",{staticClass:"col-12 col-md-4"},[r("section",{staticClass:"card section-order-shipping"},[r("div",{staticClass:"card-block"},[r("div",{staticClass:"card-title d-flex align-items-center justify-content-between"},[r("h4",[t._v("Thông tin vận chuyển")]),r("p-tooltip",{attrs:{label:"Sửa thông tin",position:"top",type:"dark"}},[r("p-button",{attrs:{icon:"pencil",type:"default",name:"pencil",size:"xs"},on:{click:t.handleVisibleModalUpdateOrder}})],1)],1),r("p",{staticClass:"card-text"},[r("b",[t._v("Tên:")]),t._v(" "+t._s(t._f("displayname")(t.order))),r("br"),t.order.phone?r("span",[r("b",[t._v("Điện thoại: ")]),t._v(t._s(t.order.phone)+" "),r("br")]):t._e(),r("b",[t._v("Địa chỉ:")]),t._v(" "+t._s(t.order.address)+",\n                    "),t.order.address2?r("span",[t._v(t._s(t.order.address2))]):t._e(),t._v(", "),r("span",[t._v(t._s(t.order.city)+" "+t._s(t.order.postcode))]),r("br"),t.order.state_code?r("span",[r("b",[t._v("Mã thành phố:")]),t._v(" "+t._s(t.order.state_code)),r("br")]):t._e(),r("span",[r("b",[t._v("Mã quốc gia:")]),t._v(" "+t._s(t.order.country_code))]),r("br"),t.order.shipping_code?r("span",[r("b",[t._v("Hình thức vận chuyển: ")]),t._v(t._s(t.order.shipping_method)+" ("+t._s(t.order.shipping_code.toUpperCase())+")")]):t._e()])])]),t.order.note?r("section",{staticClass:"card section-order-note"},[r("div",{staticClass:"card-block"},[r("h4",{staticClass:"card-title"},[t._v("Note")]),r("div",{staticClass:"card-text"},[t._v(t._s(t.order.note))])])]):t._e(),t.order.fulfillments.length>0?r("section",{staticClass:"card section-order-tracking"},[r("div",{staticClass:"card-block"},[r("div",{staticClass:"card-title d-flex align-items-center justify-content-between"},[r("h4",[t._v("Fulfillments")])]),r("div",{staticClass:"card-text"},t._l(t.order.fulfillments,(function(e){return r("div",{key:e.id,staticClass:"d-flex align-items-center justify-content-between"},[r("a",{attrs:{href:e.tracking_url,target:"_blank"}},[t._v(t._s(e.tracking_number))]),r("span",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"actions"},[r("p-tooltip",{attrs:{label:"Xem chi tiết",position:"top",type:"dark"}},[r("button",{staticClass:"btn--link",on:{click:function(r){return t.handleVisibleModalUpdateOrderTracking(e)}}},[t._v("\n                            Xem\n                          ")])])],1)])})),0)])]):t._e()])])])])])]),r("modal-update-order",{attrs:{visible:t.isVisibleEditOrder,current:t.order,countries:t.countries,loading:t.isOrderUpdating},on:{"update:visible":function(e){t.isVisibleEditOrder=e},save:t.handleUpdateOrder}})],1)},n=[],s=r("a34a"),a=r.n(s),o=r("2f62"),d=r("45ba"),c=r("d065"),l={data:function(){return{isUpTracking:!1,isVisibleEditOrderTracking:!1}},methods:{handleVisibleModalUpdateOrderTracking:function(t){this.trackingUpdate=t,this.isVisibleEditOrderTracking=!0},handleVisibleModalCreateOrderTracking:function(){this.isVisibleCreateOrderTracking=!0}}},u=r("5f56"),p=r("0eeb"),h=r("35d2"),f=r("a7f7"),v=r("54d7");function m(t,e,r,i,n,s,a){try{var o=t[s](a),d=o.value}catch(c){return void r(c)}o.done?e(d):Promise.resolve(d).then(i,n)}function g(t){return function(){var e=this,r=arguments;return new Promise((function(i,n){var s=t.apply(e,r);function a(t){m(s,i,n,a,o,"next",t)}function o(t){m(s,i,n,a,o,"throw",t)}a(void 0)}))}}function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function O(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var y={name:"OrderView",mixins:[u["a"],l],components:{OrderItems:p["a"],ModalUpdateOrder:h["a"]},computed:_(_(_(_({},Object(o["d"])("container",{order:function(t){return t.order}})),Object(o["d"])("shared",{productTypes:function(t){return t.productTypes},providers:function(t){return t.providers},countries:function(t){return t.countries}})),Object(o["d"])("design",{designs:function(t){return t.designs}})),{},{shopId:function(){return this.order?this.order.shop_id:0},orderId:function(){return parseInt(this.$route.params.id,10)}}),data:function(){return{editing:!1,isFetching:!1,isUpdating:!1,orderItems:[],resultFetch:{},resultUpdate:{}}},mounted:function(){this.init()},methods:_(_(_(_({},Object(o["b"])("container",[c["i"],c["o"],"getLogs"])),Object(o["b"])("shared",[f["FETCH_PRODUCT_TYPES"],f["FETCH_PROVIDERS"],f["FETCH_COUNTRIES"]])),Object(o["b"])("design",["fetchDesigns"])),{},{init:function(){var t=g(a.a.mark((function t(){var e,r,i;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=parseInt(this.$route.params.id,10),!(e<1)){t.next=3;break}return t.abrupt("return",this.$router.push({name:"order-list"}));case 3:return this.isFetching=!0,t.next=6,Promise.all([this.fetchOrder(e)]);case 6:r=t.sent,i=r.r1,this.resultFetch=i,this.isFetching=!1;case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleUpdateOrder:function(){var t=g(a.a.mark((function t(e){return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isUpdating=!0,t.next=3,this.updateOrder(Object.assign({},e||this.order,{order_items:this.orderItems}));case 3:this.resultUpdate=t.sent,this.resultUpdate&&this.resultUpdate.success?(this.$set(this,"orderItems",Object(d["d"])(this.order.order_items)),this.editing=!1,this.isVisibleEditOrder=!1,this.init(),this.$toast.open({type:"success",message:"Cập nhập order item thành công"})):this.$toast.open({type:"error",message:this.resultUpdate.message}),this.isUpdating=!1;case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleSelectedDesign:function(t){var e=t.url,r=t.item,i=t.design;this.handleUpdateOrderItem(r,{design:i,design_id:i.id,image:e})},handleSelectedProductType:function(t){var e=t.item,r=t.product;this.handleUpdateOrderItem(e,{product_type_id:r.id,product_type:r})},handleUpdateOrderItem:function(t,e){var r=this.orderItems.findIndex((function(e){var r=e.id;return r===t.id}));-1!==r&&(this.editing=!0,this.$set(this.orderItems,r,Object.assign({},t,e)))},toggleEditOrder:function(){this.editing?(this.$set(this,"orderItems",Object(d["d"])(this.order.order_items)),this.editing=!1):this.editing=!0},confirmUpdateOrder:function(t){var e=this;this.$dialog.confirm({message:"Are you sure you want to do this?",onConfirm:function(){return e.onUpdateOrderActionConfirm(t)}})},onUpdateOrderActionConfirm:function(){var t=g(a.a.mark((function t(e){var r;return a.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=Object.assign({},this.order),t.t0=e,t.next="canceled"===t.t0?4:6;break;case 4:return r.status=v["e"],t.abrupt("break",6);case 6:this.handleUpdateOrder(r);case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}),watch:{"order.order_items":function(t){this.$set(this,"orderItems",Object(d["d"])(t))}},filters:{displayname:function(t){return t.full_name||"".concat(t.first_name," ").concat(t.last_name)}}},C=y,w=r("2877"),k=Object(w["a"])(C,i,n,!1,null,null,null);e["default"]=k.exports},"408c":function(t,e,r){var i=r("2b3e"),n=function(){return i.Date.now()};t.exports=n},b047c:function(t,e,r){var i=r("1a8c"),n=r("408c"),s=r("b4b0"),a="Expected a function",o=Math.max,d=Math.min;function c(t,e,r){var c,l,u,p,h,f,v=0,m=!1,g=!1,b=!0;if("function"!=typeof t)throw new TypeError(a);function _(e){var r=c,i=l;return c=l=void 0,v=e,p=t.apply(i,r),p}function O(t){return v=t,h=setTimeout(w,e),m?_(t):p}function y(t){var r=t-f,i=t-v,n=e-r;return g?d(n,u-i):n}function C(t){var r=t-f,i=t-v;return void 0===f||r>=e||r<0||g&&i>=u}function w(){var t=n();if(C(t))return k(t);h=setTimeout(w,y(t))}function k(t){return h=void 0,b&&c?_(t):(c=l=void 0,p)}function x(){void 0!==h&&clearTimeout(h),v=0,c=f=l=h=void 0}function U(){return void 0===h?p:k(n())}function j(){var t=n(),r=C(t);if(c=arguments,l=this,f=t,r){if(void 0===h)return O(f);if(g)return clearTimeout(h),h=setTimeout(w,e),_(f)}return void 0===h&&(h=setTimeout(w,e)),p}return e=s(e)||0,i(r)&&(m=!!r.leading,g="maxWait"in r,u=g?o(s(r.maxWait)||0,e):u,b="trailing"in r?!!r.trailing:b),j.cancel=x,j.flush=U,j}t.exports=c},b4b0:function(t,e,r){var i=r("1a8c"),n=r("ffd6"),s=NaN,a=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;function u(t){if("number"==typeof t)return t;if(n(t))return s;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var r=d.test(t);return r||c.test(t)?l(t.slice(2),r?2:8):o.test(t)?s:+t}t.exports=u}}]);