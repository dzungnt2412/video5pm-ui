(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0410c823"],{"4b3e":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isFetching?n("PageDetailLoading"):n("div",{staticClass:"page"},[n("UnsavedBar",{attrs:{show:t.isShowUnsavedBar,showDiscard:!0,loading:t.isSaving,title:"Save"},on:{save:t.save,discard:t.discard}}),n("div",{staticClass:"page-header"},[n("p-button",{staticClass:"btn-pure pl-0 mb-15",attrs:{icon:"chevron-left"}},[n("router-link",{attrs:{to:{name:"product-mapping-list"}}},[t._v("\n        Product mapping rules\n      ")])],1),n("h1",{staticClass:"page-title"},[t._v(t._s(t.pageTitle))])],1),n("div",{staticClass:"page-content container-fluid"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-block"},[n("div",{staticClass:"d-flex mt-20"},[n("span",{staticClass:"mr-15 mt-10"},[t._v("Lionnix product")]),n("div",{staticClass:"form-group mb-0"},[n("p-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],class:[{"is-invalid":t.errors.has("product_type_id")}],staticStyle:{width:"250px"},attrs:{name:"product_type_id",placeholder:"Select product"},model:{value:t.form.product_type_id,callback:function(e){t.$set(t.form,"product_type_id",e)},expression:"form.product_type_id"}},t._l(t.products,(function(e,i){return n("option",{key:i,domProps:{value:e.id}},[t._v("\n                    "+t._s(e.name)+"\n                  ")])})),0),t.errors.has("product_type_id")?n("div",{staticClass:"invalid-feedback"},[t._v("\n                  Product type is required\n                ")]):t._e()],1)]),n("div",{staticClass:"d-flex mt-15 align-items-center"},[n("p",{staticClass:"m-0 mr-30"},[t._v("Must match")]),n("p-radio",{staticClass:"mr-15",attrs:{"native-value":!0},model:{value:t.form.disjunctive,callback:function(e){t.$set(t.form,"disjunctive",e)},expression:"form.disjunctive"}},[t._v("\n                All conditions\n              ")]),n("p-radio",{attrs:{"native-value":!1},model:{value:t.form.disjunctive,callback:function(e){t.$set(t.form,"disjunctive",e)},expression:"form.disjunctive"}},[t._v("\n                Any condition\n              ")])],1),n("div",[t._l(t.form.rules,(function(e,i){return n("condition-item",{key:i,ref:"conditions",refInFor:!0,attrs:{condition:e,"disable-remove":0===i,type:"product_type"},on:{remove:function(e){return t.removeCondition(i)},input:function(e){return t.changeCondition(i,e)}}})})),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 mt-2"},[n("p-button",{staticClass:"mt-2",attrs:{type:"default"},on:{click:function(e){return e.preventDefault(),t.addCondition(e)}}},[t._v("\n                    Add new condition\n                  ")])],1)])],2)])])])]),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"d-flex justify-content-between"},[t.productMappingState.id?n("p-button",{attrs:{type:"danger",loading:t.isDeleting},on:{click:t.showConfirmDelete,disabled:t.isDeleting}},[t._v("\n            Delete\n          ")]):n("div"),n("div",{staticClass:"d-flex"},[n("p-button",{attrs:{type:"default"},on:{click:t.discard}},[t._v("\n              Cancel\n            ")]),n("p-button",{staticClass:"ml-15",attrs:{disabled:t.isSaving,loading:t.isSaving},on:{click:t.save}},[t._v("\n              Save\n            ")])],1)],1)])])])],1)},r=[],a=n("a34a"),s=n.n(a),o=n("2f62"),c=n("45ba"),u=n("d6e0"),l=n("5906");function d(t,e){return h(t)||m(t,e)||f(t,e)||p()}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t,e){if(t){if("string"===typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function m(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done);i=!0)if(n.push(s.value),e&&n.length===e)break}catch(c){r=!0,a=c}finally{try{i||null==o["return"]||o["return"]()}finally{if(r)throw a}}return n}}function h(t){if(Array.isArray(t))return t}function g(t,e,n,i,r,a,s){try{var o=t[a](s),c=o.value}catch(u){return void n(u)}o.done?e(c):Promise.resolve(c).then(i,r)}function y(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function s(t){g(a,i,r,s,o,"next",t)}function o(t){g(a,i,r,s,o,"throw",t)}s(void 0)}))}}function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _={name:"ProductMappingForm",components:{ConditionItem:u["a"]},data:function(){return{mode:"new",form:{disjunctive:!0,product_type_id:null,type:l["d"].product_type,rules:[{column:"title",relation:"contain",condition:""}]},initialForm:{},isShowUnsavedBar:!1,isFetching:!1,isSaving:!1,isDeleting:!1}},computed:w(w({},Object(o["d"])("orderMapping",{productMappingState:function(t){return t.orderMapping},products:function(t){return t.productTypes}})),{},{pageTitle:function(){return"new"===this.mode?"Create product mapping rule":"Update product mapping rule"}}),watch:{form:{handler:function(t){this.isShowUnsavedBar=Object(c["f"])(t,this.initialForm)},deep:!0},initialForm:{handler:function(t){this.isShowUnsavedBar=Object(c["f"])(t,this.form)},deep:!0}},methods:w(w({},Object(o["b"])("orderMapping",{createOrUpdateOrderMapping:"createOrUpdateOrderMapping",fetchOrderMapping:"fetchOrderMapping",deleteOrderMapping:"deleteOrderMapping",fetchProductTypes:"fetchProductTypes"})),{},{removeCondition:function(t){this.form.rules.splice(t,1)},changeCondition:function(t,e){this.$set(this.form.rules,t,e)},addCondition:function(){var t=this.form.rules;t.push(w(w({},t[t.length-1]),{},{condition:""}))},fetch:function(){var t=y(s.a.mark((function t(){var e,n,i,r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isFetching=!0,e=[this.fetchProductTypes()],this.$route.params.id&&"new"!==this.$route.params.id&&(this.mode="edit",e.push(this.fetchOrderMapping({type:l["d"].product_type,id:+this.$route.params.id}))),t.next=5,Promise.all(e);case 5:n=t.sent,i=d(n,2),r=i[1],r&&r.success&&(this.form=Object(c["d"])(this.productMappingState)),this.initialForm=Object(c["d"])(this.form),this.isFetching=!1;case 11:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),discard:function(){this.form=Object(c["d"])(this.initialForm)},showConfirmDelete:function(){var t=this;this.$dialog.confirm({title:"Delete product mapping?",message:"Are you sure you want to delete this product mapping?",confirmText:"Delete",onConfirm:function(){return t.delete()},type:"danger"})},save:function(){var t=y(s.a.mark((function t(){var e,n,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$validator.validateAll();case 2:if(e=t.sent,n=!0,!this.$refs.conditions||!this.$refs.conditions.length){t.next=9;break}return t.next=7,Object(c["a"])(this.$refs.conditions,function(){var t=y(s.a.mark((function t(e){var n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$validator.validateAll();case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 7:i=t.sent,n=i.length===this.$refs.conditions.length;case 9:if(e&&n){t.next=11;break}return t.abrupt("return");case 11:if(this.isSaving=!0,"new"!==this.mode){t.next=17;break}return t.next=15,this.create();case 15:t.next=19;break;case 17:return t.next=19,this.update();case 19:this.isSaving=!1;case 20:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),create:function(){var t=y(s.a.mark((function t(){var e;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.createOrUpdateOrderMapping({type:l["d"].product_type,payload:Object(c["d"])(this.form)});case 2:e=t.sent,e.success?(this.$toast.open({type:"success",message:"Your product mapping was created"}),this.$router.push({name:"product-mapping-update",params:{id:e.id}})):this.$toast.open({type:"error",message:e.message||"Something went wrong. Please try again later"});case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),update:function(){var t=y(s.a.mark((function t(){var e;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.createOrUpdateOrderMapping({type:l["d"].product_type,payload:Object(c["d"])(this.form)});case 2:if(e=t.sent,!e.success){t.next=9;break}return this.$toast.open({type:"success",message:"Your product mapping was updated"}),t.next=7,this.fetch();case 7:t.next=10;break;case 9:this.$toast.open({type:"error",message:e.message||"Something went wrong. Please try again later"});case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),delete:function(){var t=y(s.a.mark((function t(){var e;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isDeleting=!0,t.next=3,this.deleteOrderMapping({type:l["d"].product_type,id:this.productMappingState.id});case 3:e=t.sent,e.success?(this.$toast.open({type:"success",message:"Your product mapping was deleted"}),this.$router.push({name:"product-mapping-list"})):this.$toast.open({type:"error",message:e.message||"Something went wrong. Please try again later"}),this.isDeleting=!1;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}),created:function(){this.fetch()}},O=_,C=n("2877"),j=Object(C["a"])(O,i,r,!1,null,null,null);e["default"]=j.exports},5906:function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s}));var i={quantity:"quantity",product_type:"product-type",option:"option"},r=[{text:"Product title",value:"title"},{text:"Variant title",value:"product_variant"}],a=[{text:"equals",value:"equal"},{text:"contains",value:"contain"},{text:"starts with",value:"start_with"},{text:"ends with",value:"end_with"},{text:"matches phrase",value:"match_phrase"}],s=[{text:"matches template",value:"match"}]},d6e0:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"row"},[n("div",{staticClass:"col-11"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-6 col-sm-4 mt-2 d-flex pr-2"},[n("p-select",{model:{value:t.internalValue.column,callback:function(e){t.$set(t.internalValue,"column",e)},expression:"internalValue.column"}},t._l(t.conditionColumns,(function(e){return n("option",{key:e.value,domProps:{value:e.value}},[t._v("\n            "+t._s(e.text)+"\n          ")])})),0)],1),n("div",{staticClass:"col-6 col-sm-4 mt-2 d-flex px-2"},[n("p-select",{staticClass:"flex-fill",model:{value:t.internalValue.relation,callback:function(e){t.$set(t.internalValue,"relation",e)},expression:"internalValue.relation"}},t._l(t.relations,(function(e){return n("option",{key:e.value,domProps:{value:e.value}},[t._v("\n            "+t._s(e.text)+"\n          ")])})),0)],1),t.selectedProperty?n("div",{staticClass:"col-12 col-sm-4 mt-2 mb-0 px-2 form-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.internalValue.condition,expression:"internalValue.condition"},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"flex-fill form-control",class:[{"is-invalid":t.errors.has("condition")}],attrs:{type:"text",name:"condition"},domProps:{value:t.internalValue.condition},on:{input:function(e){e.target.composing||t.$set(t.internalValue,"condition",e.target.value)}}}),t.errors.has("condition")?n("div",{staticClass:"invalid-feedback"},[t._v("\n          Field is required\n        ")]):t._e()]):t._e()])]),n("div",{staticClass:"col-1 mt-2 pl-2"},[t.disableRemove?t._e():n("p-button",{attrs:{type:"default",icon:"close"},on:{click:function(e){return e.preventDefault(),t.handleRemove(e)}}})],1)])},r=[],a=n("45ba"),s=n("5906"),o={name:"ConditionItem",props:{type:{type:String,default:s["d"].product_type},condition:{type:Object,default:function(){return{column:"tag",relation:"equals",condition:""}}},disableRemove:{type:Boolean,default:!1}},computed:{conditionColumns:function(){return s["a"]},relations:function(){return this.type===s["d"].quantity?s["c"]:s["b"]},selectedProperty:function(){var t=this;return this.conditionColumns.find((function(e){var n=e.value;return n===t.internalValue.column}))}},data:function(){return{internalValue:{}}},created:function(){this.internalValue=Object(a["d"])(this.condition)},methods:{handleRemove:function(){this.$emit("remove",this.value)}},watch:{condition:{handler:function(t){this.internalValue=Object(a["d"])(t)},deep:!0},internalValue:{handler:function(t){JSON.stringify(this.internalValue)!=JSON.stringify(this.condition)&&this.$emit("input",t)},deep:!0}}},c=o,u=n("2877"),l=Object(u["a"])(c,i,r,!1,null,null,null);e["a"]=l.exports}}]);