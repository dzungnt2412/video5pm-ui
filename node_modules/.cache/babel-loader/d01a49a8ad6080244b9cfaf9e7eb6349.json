{"remainingRequest":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/babel-loader/lib/index.js!/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/tiendzung/workspace/video5pm/video5pm-ui/src/packages/ticket/views/List.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/src/packages/ticket/views/List.vue","mtime":1603898990384},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/cache-loader/dist/cjs.js","mtime":1601450297498},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/babel-loader/lib/index.js","mtime":1597736171393},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/cache-loader/dist/cjs.js","mtime":1601450297498},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/vue-loader/lib/index.js","mtime":1597736282333}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapState, mapActions } from 'vuex';\nimport EmptySearchResult from '@components/shared/EmptySearchResult';\nimport debounce from 'lodash/debounce';\nimport mixinRoute from '@core/mixins/route';\nimport mixinTable from '@core/mixins/table';\nimport { VclTable } from 'vue-content-loading';\nimport ModalFilter from './components/ModalFilter';\nimport { truncate } from '@core/utils/string';\nexport default {\n  name: 'TicketList',\n  mixins: [mixinRoute, mixinTable],\n  components: {\n    EmptySearchResult: EmptySearchResult,\n    VclTable: VclTable,\n    ModalFilter: ModalFilter\n  },\n  data: function data() {\n    return {\n      showModalFilter: false,\n      isFetching: false,\n      result: {},\n      filterKeyShow: ['support', 'search', 'category', 'seller', 'accountant', 'start_date', 'end_date', 'sort'],\n      filter: {\n        page: 1,\n        search: '',\n        sort: '',\n        limit: 50\n      }\n    };\n  },\n  filters: {\n    textKeyFilter: function textKeyFilter(v) {\n      return v.replace('_', ' ');\n    }\n  },\n  computed: _objectSpread(_objectSpread({}, mapState('ticket', {\n    tickets: function tickets(state) {\n      return state.tickets;\n    },\n    count: function count(state) {\n      return state.count;\n    },\n    categories: function categories(state) {\n      return state.categories;\n    }\n  })), {}, {\n    ticketStatus: function ticketStatus() {\n      return ['open', 'process', 'close'];\n    }\n  }),\n  created: function created() {\n    this.filter = this.getRouteQuery();\n  },\n  methods: _objectSpread(_objectSpread({\n    truncate: truncate\n  }, mapActions('ticket', ['fetchTickets', 'fetchCategories'])), {}, {\n    init: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.isFetching = true;\n                this.handleUpdateRouteQuery();\n                _context.next = 4;\n                return this.fetchTickets(this.filter);\n\n              case 4:\n                this.result = _context.sent;\n                _context.next = 7;\n                return this.fetchCategories();\n\n              case 7:\n                this.isFetching = false;\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function init() {\n        return _init.apply(this, arguments);\n      }\n\n      return init;\n    }(),\n    handleSearch: debounce(function (e) {\n      this.filter.search = e.target.value;\n    }, 500),\n    handlerCreateTicket: function handlerCreateTicket() {\n      this.$router.push({\n        name: 'ticket-form'\n      });\n    },\n    onSort: function onSort(order) {\n      this.filter.sort = order;\n    },\n    handlerShowModalFilter: function handlerShowModalFilter() {\n      this.showModalFilter = true;\n    },\n    handlerFilterAdvanced: function handlerFilterAdvanced(v) {\n      this.filter = Object.assign(this.filter, v);\n      this.init();\n      this.showModalFilter = false;\n    }\n  }),\n  watch: {\n    filter: {\n      handler: function handler() {\n        this.init();\n      },\n      deep: true\n    }\n  }\n};",{"version":3,"sources":["List.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <p-input\n      placeholder=\"Tìm kiếm ticket theo Mã đơn hàng/Tiêu đề\"\n      prefixIcon=\"search\"\n      class=\"mb-2 taf\"\n      type=\"search\"\n      :value=\"filter.search\"\n      @keyup.enter=\"handleSearch\"\n    >\n      <template slot=\"append\">\n        <p-button\n          type=\"default\"\n          icon=\"close\"\n          v-if=\"filter.search\"\n          @click=\"clearSearch\"\n        ></p-button>\n        <p-button type=\"default\" slot=\"trigger\" @click=\"handlerShowModalFilter\">\n          <span class=\"mr-10\">Lọc nâng cao</span>\n        </p-button>\n        <p-dropdown class=\"ml-20\" :dropdown-class=\"'dropdown-menu-right'\">\n          <p-button type=\"dark\" slot=\"trigger\">\n            <span class=\"mr-10\">Sắp xếp</span>\n            <p-icon :icon-pack=\"'md'\" name=\"swap-vertical\"></p-icon>\n          </p-button>\n          <template>\n            <p-dropdown-item @click=\"onSort('created_at:desc')\"\n              >Ngày tạo mới nhất</p-dropdown-item\n            >\n            <p-dropdown-item @click=\"onSort('created_at:asc')\"\n              >Ngày tạo cũ nhất</p-dropdown-item\n            >\n            <p-dropdown-item @click=\"onSort('updated_at:desc')\"\n              >Ngày trả lời mới nhất</p-dropdown-item\n            >\n            <p-dropdown-item @click=\"onSort('updated_at:asc')\"\n              >Ngày trả lời cũ nhất</p-dropdown-item\n            >\n          </template>\n        </p-dropdown>\n      </template>\n    </p-input>\n    <div class=\"card\">\n      <div class=\"card-body\">\n        <div class=\"d-filters\">\n          <!-- eslint-disable -->\n          <div\n            v-for=\"(item, key) in filter\"\n            :key=\"key\"\n            v-if=\"item && filterKeyShow.indexOf(key) !== -1\"\n            class=\"badge badge-lg badge-outline badge-dark\"\n          >\n            <span>{{ key | textKeyFilter }}: {{ item }}</span>\n            <a href=\"#\" @click=\"filter[key] = ''\"\n              ><p-icon name=\"close-mini\"></p-icon\n            ></a>\n          </div>\n          <!-- eslint-enable -->\n        </div>\n        <VclTable class=\"my-20\" v-if=\"isFetching\"></VclTable>\n        <template v-else-if=\"tickets.length\">\n          <div class=\"table-responsive-xl\">\n            <table class=\"table table-hover table-border\">\n              <thead>\n                <tr>\n                  <th width=\"50\">ID</th>\n                  <th>Tiêu đề</th>\n                  <th>Mã đơn hàng</th>\n                  <th class=\"text-right\">Ngày tạo</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr v-for=\"(item, index) in tickets\" :key=\"index\">\n                  <td>{{ item.id }}</td>\n                  <td>\n                    <router-link\n                      class=\"text-no-underline\"\n                      slot=\"reference\"\n                      :to=\"{\n                        name: 'ticket-view',\n                        params: { id: item.id },\n                      }\"\n                    >\n                      <strong>{{ truncate(item.subject, 50) }}</strong>\n                    </router-link>\n                  </td>\n                  <td>{{ item.ref_id }}</td>\n                  <td class=\"text-right\">{{\n                    item.created_at | datetime('dd/MM/yyyy HH:mm')\n                  }}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          <div class=\"d-flex justify-content-between align-items-center\">\n            <span>{{ paginationLabel }}</span>\n            <p-pagination\n              :total=\"count\"\n              :perPage=\"filter.limit\"\n              :current.sync=\"filter.page\"\n              size=\"sm\"\n            ></p-pagination>\n          </div>\n        </template>\n        <EmptySearchResult\n          v-else\n          title=\"Không tìm thấy ticket\"\n        ></EmptySearchResult>\n      </div>\n    </div>\n    <modal-filter\n      :visible.sync=\"showModalFilter\"\n      :categories=\"categories\"\n      @update=\"handlerFilterAdvanced\"\n    ></modal-filter>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapActions } from 'vuex'\nimport EmptySearchResult from '@components/shared/EmptySearchResult'\nimport debounce from 'lodash/debounce'\nimport mixinRoute from '@core/mixins/route'\nimport mixinTable from '@core/mixins/table'\nimport { VclTable } from 'vue-content-loading'\nimport ModalFilter from './components/ModalFilter'\nimport { truncate } from '@core/utils/string'\n\nexport default {\n  name: 'TicketList',\n  mixins: [mixinRoute, mixinTable],\n  components: {\n    EmptySearchResult,\n    VclTable,\n    ModalFilter,\n  },\n  data() {\n    return {\n      showModalFilter: false,\n      isFetching: false,\n      result: {},\n      filterKeyShow: [\n        'support',\n        'search',\n        'category',\n        'seller',\n        'accountant',\n        'start_date',\n        'end_date',\n        'sort',\n      ],\n      filter: {\n        page: 1,\n        search: '',\n        sort: '',\n        limit: 50,\n      },\n    }\n  },\n  filters: {\n    textKeyFilter(v) {\n      return v.replace('_', ' ')\n    },\n  },\n  computed: {\n    ...mapState('ticket', {\n      tickets: (state) => state.tickets,\n      count: (state) => state.count,\n      categories: (state) => state.categories,\n    }),\n\n    ticketStatus() {\n      return ['open', 'process', 'close']\n    },\n  },\n  created() {\n    this.filter = this.getRouteQuery()\n  },\n  methods: {\n    truncate,\n    ...mapActions('ticket', ['fetchTickets', 'fetchCategories']),\n\n    async init() {\n      this.isFetching = true\n      this.handleUpdateRouteQuery()\n      this.result = await this.fetchTickets(this.filter)\n      await this.fetchCategories()\n      this.isFetching = false\n    },\n\n    handleSearch: debounce(function(e) {\n      this.filter.search = e.target.value\n    }, 500),\n\n    handlerCreateTicket() {\n      this.$router.push({ name: 'ticket-form' })\n    },\n\n    onSort(order) {\n      this.filter.sort = order\n    },\n    handlerShowModalFilter() {\n      this.showModalFilter = true\n    },\n\n    handlerFilterAdvanced(v) {\n      this.filter = Object.assign(this.filter, v)\n      this.init()\n      this.showModalFilter = false\n    },\n  },\n  watch: {\n    filter: {\n      handler: function() {\n        this.init()\n      },\n      deep: true,\n    },\n  },\n}\n</script>\n"],"sourceRoot":"src/packages/ticket/views"}]}