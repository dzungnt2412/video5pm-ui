{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-f27e7ef4\"],{\"369c\":function(t,e,n){\"use strict\";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isFetching?n(\"PageDetailLoading\"):n(\"div\",{staticClass:\"page\"},[n(\"UnsavedBar\",{attrs:{show:t.isShowUnsavedBar,showDiscard:!0,loading:t.isSaving,title:\"Save\"},on:{save:t.save,discard:t.discard}}),n(\"div\",{staticClass:\"page-header\"},[n(\"p-button\",{staticClass:\"btn-pure pl-0 mb-15\",attrs:{icon:\"chevron-left\"}},[n(\"router-link\",{attrs:{to:{name:\"option-mapping-list\"}}},[t._v(\"\\n        Option mapping rules\\n      \")])],1),n(\"h1\",{staticClass:\"page-title\"},[t._v(t._s(t.pageTitle))])],1),n(\"div\",{staticClass:\"page-content container-fluid\"},[n(\"div\",{staticClass:\"row\"},[n(\"div\",{staticClass:\"col-12\"},[n(\"div\",{staticClass:\"card\"},[n(\"div\",{staticClass:\"card-block\"},[n(\"div\",{staticClass:\"row\"},[n(\"div\",{staticClass:\"col-12\"},[n(\"div\",{staticClass:\"d-flex\"},[n(\"h5\",{staticClass:\"white-space-nowrap mr-15\"},[t._v(\"Lionnix Product\")]),n(\"div\",{staticClass:\"form-group mb-0\"},[n(\"p-select\",{directives:[{name:\"validate\",rawName:\"v-validate\",value:\"required\",expression:\"'required'\"}],class:[{\"is-invalid\":t.errors.has(\"product_type_id\")}],attrs:{placeholder:\"Select product\",name:\"product_type_id\"},on:{input:t.onProductTypeChange},model:{value:t.form.product_type_id,callback:function(e){t.$set(t.form,\"product_type_id\",e)},expression:\"form.product_type_id\"}},t._l(t.products,(function(e){return n(\"option\",{key:e.id,domProps:{value:e.id}},[t._v(\"\\n                        \"+t._s(e.name)+\"\\n                      \")])})),0),t.errors.has(\"product_type_id\")?n(\"div\",{staticClass:\"invalid-feedback\"},[t._v(\"\\n                      Product type is required\\n                    \")]):t._e()],1)])])]),n(\"div\",{staticClass:\"row\"},[n(\"div\",{staticClass:\"col-6\"},[n(\"h4\",[t._v(\"Lionnix\")])]),n(\"div\",{staticClass:\"col-6\"},[n(\"h4\",[t._v(\"Shop\")])])]),t._l(t.form.rules,(function(e,i){return n(\"div\",{key:i,staticClass:\"row mb-15\"},[n(\"div\",{staticClass:\"col-6\"},[n(\"div\",{staticClass:\"form-group flex-fill\"},[n(\"label\",[t._v(\"Option\")]),n(\"p-select\",{directives:[{name:\"validate\",rawName:\"v-validate\",value:\"required\",expression:\"'required'\"}],class:[{\"is-invalid\":t.errors.has(\"option_set_target-\"+i)}],attrs:{value:e.option_set.target_value,placeholder:\"Select option set\",name:\"option_set_target-\"+i},on:{input:function(n){return t.onOptionSetTargetValueChange(e,n)}}},t._l(t.optionSets,(function(e,i){return n(\"option\",{key:i,domProps:{value:e.id}},[t._v(\"\\n                      \"+t._s(e.name)+\"\\n                    \")])})),0),t.errors.has(\"option_set_target-\"+i)?n(\"div\",{staticClass:\"invalid-feedback\"},[t._v(\"\\n                    Please choose Lionnix option\\n                  \")]):t._e()],1)]),n(\"div\",{staticClass:\"col-6\"},[n(\"div\",{staticClass:\"d-flex ml--10 mt--10\"},[n(\"div\",{staticClass:\"form-group flex-fill pl-10 pt-10\"},[n(\"label\",[t._v(\"Option values\")]),n(\"input\",{directives:[{name:\"validate\",rawName:\"v-validate\",value:\"required\",expression:\"'required'\"}],staticClass:\"flex-fill form-control\",class:[{\"is-invalid\":t.errors.has(\"option_conditions-\"+i)}],attrs:{placeholder:\"Option values, separated by commas\",type:\"text\",name:\"option_conditions-\"+i},domProps:{value:e.option.conditions},on:{input:function(n){return t.onRuleOptionConditionsChange(e,n.target.value)}}}),t.errors.has(\"option_conditions-\"+i)?n(\"div\",{staticClass:\"invalid-feedback\"},[t._v(\"\\n                      Please enter option values, separated by commas\\n                    \")]):t._e()])])]),n(\"div\",{staticClass:\"col-6\"},[t.getOptionsWithOptionSetId(e.option_set.target_value).length>0?n(\"div\",{staticClass:\"form-group mb-2\"},[n(\"label\",[t._v(\"\\n                    Values\\n                  \")]),t._l(t.getOptionsWithOptionSetId(e.option_set.target_value),(function(a,r){return n(\"div\",{key:r,staticClass:\"mb-10\"},[n(\"p-select\",{directives:[{name:\"validate\",rawName:\"v-validate\",value:\"required\",expression:\"'required'\"}],class:[{\"is-invalid\":t.errors.has(\"option_target-\"+i+\"-\"+r)}],attrs:{value:t.getOptionTargetValueByIndex(i,r),placeholder:\"Select option value\",name:\"option_target-\"+i+\"-\"+r},on:{input:function(e){return t.setOptionTargetValueByIndex(i,r,e)}}},t._l(t.getOptionsWithOptionSetId(e.option_set.target_value),(function(e,i){return n(\"option\",{key:i,domProps:{value:e.id}},[t._v(\"\\n                        \"+t._s(e.value)+\"\\n                      \")])})),0),t.errors.has(\"option_target-\"+i+\"-\"+r)?n(\"div\",{staticClass:\"invalid-feedback\"},[t._v(\"\\n                      Please choose a option value\\n                    \")]):t._e()],1)}))],2):t._e()]),n(\"div\",{staticClass:\"col-6\"},[e.option.values.length>0?n(\"div\",{staticClass:\"form-group mb-0\"},[n(\"label\",[t._v(\"\\n                    Values\\n                  \")]),t._l(e.option.values,(function(a,r){return n(\"div\",{key:r,staticClass:\"mb-10\"},[n(\"p-select\",{directives:[{name:\"validate\",rawName:\"v-validate\",value:\"required\",expression:\"'required'\"}],class:[{\"is-invalid\":t.errors.has(\"option_value-\"+i+\"-\"+r)}],attrs:{value:t.getOptionValueByIndex(i,r),placeholder:\"Select option value\",name:\"option_value-\"+i+\"-\"+r},on:{input:function(e){return t.setOptionValueByIndex(i,r,e)}}},t._l(e.option.values,(function(e,i){return n(\"option\",{key:i,domProps:{value:e}},[t._v(\"\\n                        \"+t._s(e)+\"\\n                      \")])})),0),t.errors.has(\"option_value-\"+i+\"-\"+r)?n(\"div\",{staticClass:\"invalid-feedback\"},[t._v(\"\\n                      Please choose a option value\\n                    \")]):t._e()],1)}))],2):t._e()]),n(\"div\",{staticClass:\"col-12\"},[n(\"div\",{staticClass:\"d-flex justify-content-end\"},[n(\"a\",{staticClass:\"btn-delete-option\",attrs:{href:\"#\"},on:{click:function(e){return t.deleteOption(i)}}},[t._v(\"\\n                    Delete option\\n                  \")])])])])})),n(\"div\",{staticClass:\"row\"},[n(\"div\",{staticClass:\"col-12\",on:{click:t.addNewOption}},[n(\"p-button\",{attrs:{type:\"default\"}},[t._v(\"Add new option\")])],1)])],2)])])]),n(\"div\",{staticClass:\"row\"},[n(\"div\",{staticClass:\"col-12\"},[n(\"div\",{staticClass:\"d-flex justify-content-between\"},[t.optionMappingState.id?n(\"p-button\",{attrs:{type:\"danger\",loading:t.isDeleting},on:{click:t.showConfirmDelete,disabled:t.isDeleting}},[t._v(\"\\n            Delete\\n          \")]):n(\"div\"),n(\"div\",{staticClass:\"d-flex\"},[n(\"p-button\",{attrs:{type:\"default\"},on:{click:t.discard}},[t._v(\"\\n              Cancel\\n            \")]),n(\"p-button\",{staticClass:\"ml-15\",attrs:{disabled:t.isSaving,loading:t.isSaving},on:{click:t.save}},[t._v(\"\\n              Save\\n            \")])],1)],1)])])])],1)},a=[],r=n(\"a34a\"),o=n.n(r),s=n(\"2f62\"),u=n(\"45ba\"),l=n(\"5906\");function c(t,e){return h(t)||f(t,e)||d(t,e)||p()}function p(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function d(t,e){if(t){if(\"string\"===typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===n&&t.constructor&&(n=t.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(t):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function f(t,e){if(\"undefined\"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)if(n.push(o.value),e&&n.length===e)break}catch(u){a=!0,r=u}finally{try{i||null==s[\"return\"]||s[\"return\"]()}finally{if(a)throw r}}return n}}function h(t){if(Array.isArray(t))return t}function m(t,e,n,i,a,r,o){try{var s=t[r](o),u=s.value}catch(l){return void n(l)}s.done?e(u):Promise.resolve(u).then(i,a)}function g(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var r=t.apply(e,n);function o(t){m(r,i,a,o,s,\"next\",t)}function s(t){m(r,i,a,o,s,\"throw\",t)}o(void 0)}))}}function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){w(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b={name:\"OptionMappingForm\",data:function(){return{mode:\"new\",form:{product_type_id:null,rules:[]},initialForm:{},isShowUnsavedBar:!1,isFetching:!1,isSaving:!1,isDeleting:!1}},computed:y(y({},Object(s[\"d\"])(\"orderMapping\",{optionMappingState:function(t){return t.orderMapping},products:function(t){return t.productTypes},options:function(t){return t.options},optionSets:function(t){return t.optionSets}})),{},{pageTitle:function(){return\"new\"===this.mode?\"Create option mapping rule\":\"Update option mapping rule\"},getOptionsWithOptionSetId:function(){var t=this;return function(e){return t.options.filter((function(t){return t.option_set_id===e}))}},getOptionValueByIndex:function(){var t=this;return function(e,n){var i=t.form.rules[e];if(!i)return null;var a=i.option.values[n];return a||null}},getOptionTargetValueByIndex:function(){var t=this;return function(e,n){var i=t.form.rules[e];if(!i)return null;var a=i.option.target_values[n];return a||null}}}),watch:{form:{handler:function(t){this.isShowUnsavedBar=Object(u[\"f\"])(t,this.initialForm)},deep:!0},initialForm:{handler:function(t){this.isShowUnsavedBar=Object(u[\"f\"])(t,this.form)},deep:!0}},methods:y(y({},Object(s[\"b\"])(\"orderMapping\",{createOrUpdateOrderMapping:\"createOrUpdateOrderMapping\",fetchOrderMapping:\"fetchOrderMapping\",deleteOrderMapping:\"deleteOrderMapping\",fetchProductTypes:\"fetchProductTypes\",fetchOptionsByProductId:\"fetchOptionsByProductId\"})),{},{addNewOption:function(){var t=this.form.rules;t.push({option_set:{condition:\"\",target_value:null},option:{conditions:\"\",values:[],target_values:[]}})},deleteOption:function(t){this.form.rules.splice(t,1)},onOptionSetTargetValueChange:function(t,e){t.option_set.target_value=e;var n=this.getOptionsWithOptionSetId(e);t.option.target_values=n.map((function(t){return t.id}))},onRuleOptionConditionsChange:function(t,e){t.option.conditions=e;var n=e.split(\",\").filter((function(t){return\"\"!==t.trim()}));t.option.values.forEach((function(e,i){n[i]&&(t.option.values[i]=n[i])})),n.length>t.option.values.length?n.slice(t.option.values.length).forEach((function(e){t.option.values.push(e)})):n.length<t.option.values.length&&(t.option.values=t.option.values.slice(0,n.length))},setOptionValueByIndex:function(t,e,n){var i=this.form.rules[t];this.$set(i.option.values,e,n)},setOptionTargetValueByIndex:function(t,e,n){var i=this.form.rules[t];this.$set(i.option.target_values,e,n)},onProductTypeChange:function(){var t=g(o.a.mark((function t(e){var n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.fetchOptionsByProductId(e);case 2:n=t.sent,n.success||this.$toast.open({type:\"error\",message:n.message||\"Something went wrong. Please try again later\"});case 4:case\"end\":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),fetch:function(){var t=g(o.a.mark((function t(){var e,n,i,a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isFetching=!0,e=[this.fetchProductTypes()],this.$route.params.id&&\"new\"!==this.$route.params.id&&(this.mode=\"edit\",e.push(this.fetchOrderMapping({type:l[\"d\"].option,id:+this.$route.params.id}))),t.next=5,Promise.all(e);case 5:if(n=t.sent,i=c(n,2),a=i[1],!a||!a.success){t.next=11;break}return t.next=11,this.transformStateToLocalForm(this.optionMappingState);case 11:this.initialForm=Object(u[\"d\"])(this.form),this.isFetching=!1;case 13:case\"end\":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),transformStateToLocalForm:function(){var t=g(o.a.mark((function t(e){var n,i,a=this;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.form.product_type_id=e.product_type_id,t.next=3,this.fetchOptionsByProductId(e.product_type_id);case 3:if(n=t.sent,n.success){t.next=7;break}return this.$toast.open({type:\"error\",message:n.message||\"Something went wrong. Please try again later\"}),t.abrupt(\"return\");case 7:i=e.rules.filter((function(t){return\"option_set\"===t.column})),this.form.rules=i.map((function(t){var n={option_set:{condition:t.condition,target_value:t.target_value?parseInt(t.target_value):null},option:{conditions:\"\",values:[],target_values:[]}};if(t.target_value){var i=a.getOptionsWithOptionSetId(parseInt(t.target_value)).map((function(t){return t.id})),r=e.rules.filter((function(t){return\"option\"===t.column&&t.target_value&&i.indexOf(parseInt(t.target_value))>-1}));n.option.values=r.map((function(t){return t.condition})),n.option.target_values=r.map((function(t){return t.target_value?parseInt(t.target_value):null})),n.option.conditions=n.option.values.join(\",\")}return n}));case 9:case\"end\":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),tranformLocalFormToPayload:function(){var t={product_type_id:this.form.product_type_id,rules:[],type:l[\"d\"].option,disjunctive:!1};return\"new\"!==this.mode&&(t.id=this.optionMappingState.id),this.form.rules.map((function(e){t.rules.push({column:\"option_set\",relation:\"equal\",condition:e.option_set.condition,target_value:String(e.option_set.target_value)}),e.option.values.map((function(n,i){t.rules.push({column:\"option\",relation:\"equal\",condition:n,target_value:String(e.option.target_values[i])})}))})),t},discard:function(){this.form=Object(u[\"d\"])(this.initialForm)},showConfirmDelete:function(){var t=this;this.$dialog.confirm({title:\"Delete option mapping?\",message:\"Are you sure you want to delete this option mapping?\",confirmText:\"Delete\",onConfirm:function(){return t.delete()},type:\"danger\"})},save:function(){var t=g(o.a.mark((function t(){var e;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$validator.validateAll();case 2:if(e=t.sent,e){t.next=5;break}return t.abrupt(\"return\");case 5:if(this.isSaving=!0,\"new\"!==this.mode){t.next=11;break}return t.next=9,this.create();case 9:t.next=13;break;case 11:return t.next=13,this.update();case 13:this.isSaving=!1;case 14:case\"end\":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),create:function(){var t=g(o.a.mark((function t(){var e,n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.tranformLocalFormToPayload(),t.next=3,this.createOrUpdateOrderMapping({type:l[\"d\"].option,payload:e});case 3:n=t.sent,n.success?(this.$toast.open({type:\"success\",message:\"Your option mapping was created\"}),this.$router.push({name:\"option-mapping-update\",params:{id:n.id}})):this.$toast.open({type:\"error\",message:n.message||\"Something went wrong. Please try again later\"});case 5:case\"end\":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),update:function(){var t=g(o.a.mark((function t(){var e,n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.tranformLocalFormToPayload(),t.next=3,this.createOrUpdateOrderMapping({type:l[\"d\"].option,payload:e});case 3:if(n=t.sent,!n.success){t.next=10;break}return this.$toast.open({type:\"success\",message:\"Your option mapping was updated\"}),t.next=8,this.fetch();case 8:t.next=11;break;case 10:this.$toast.open({type:\"error\",message:n.message||\"Something went wrong. Please try again later\"});case 11:case\"end\":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),delete:function(){var t=g(o.a.mark((function t(){var e;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.isDeleting=!0,t.next=3,this.deleteOrderMapping({type:l[\"d\"].option,id:this.optionMappingState.id});case 3:e=t.sent,e.success?(this.$toast.open({type:\"success\",message:\"Your option mapping was deleted\"}),this.$router.push({name:\"option-mapping-list\"})):this.$toast.open({type:\"error\",message:e.message||\"Something went wrong. Please try again later\"}),this.isDeleting=!1;case 6:case\"end\":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}),created:function(){this.fetch()}},O=b,x=n(\"2877\"),C=Object(x[\"a\"])(O,i,a,!1,null,null,null);e[\"default\"]=C.exports},5906:function(t,e,n){\"use strict\";n.d(e,\"d\",(function(){return i})),n.d(e,\"a\",(function(){return a})),n.d(e,\"b\",(function(){return r})),n.d(e,\"c\",(function(){return o}));var i={quantity:\"quantity\",product_type:\"product-type\",option:\"option\"},a=[{text:\"Product title\",value:\"title\"},{text:\"Variant title\",value:\"product_variant\"}],r=[{text:\"equals\",value:\"equal\"},{text:\"contains\",value:\"contain\"},{text:\"starts with\",value:\"start_with\"},{text:\"ends with\",value:\"end_with\"},{text:\"matches phrase\",value:\"match_phrase\"}],o=[{text:\"matches template\",value:\"match\"}]}}]);","extractedComments":[]}