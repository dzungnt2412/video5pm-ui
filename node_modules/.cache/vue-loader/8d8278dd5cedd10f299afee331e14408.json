{"remainingRequest":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/tiendzung/workspace/video5pm/video5pm-ui/src/packages/fulfillment/views/List.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/src/packages/fulfillment/views/List.vue","mtime":1604479001989},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/babel-loader/lib/index.js","mtime":1604479000077},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/cache-loader/dist/cjs.js","mtime":1604479000133},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/vue-loader/lib/index.js","mtime":1604479001773}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport EmptySearchResult from '@components/shared/EmptySearchResult'\nimport { mapState, mapActions } from 'vuex'\nimport mixinRoute from '@core/mixins/route'\nimport { VclTable } from 'vue-content-loading'\nimport mixinTable from '@core/mixins/table'\nimport mixinExportOrder from '@/packages/container/mixins/export-file'\nimport { FULLFILL_EXPORT_BUCKET } from '@core/constants/storage'\nexport default {\n  name: 'FulfillmentList',\n  mixins: [mixinRoute, mixinTable, mixinExportOrder],\n  components: {\n    EmptySearchResult,\n    VclTable,\n  },\n  data: () => ({\n    isFetching: false,\n    filter: {\n      page: 1,\n      search: '',\n      limit: 50,\n      user_id: 0,\n    },\n  }),\n  computed: {\n    ...mapState('fulfillment', {\n      fulfillments: (state) => state.fulfillments,\n      count: (state) => state.count,\n      download: (state) => state.download,\n    }),\n  },\n  created() {\n    this.filter = this.getRouteQuery()\n\n    this.fetch()\n  },\n  methods: {\n    ...mapActions('fulfillment', [\n      'fetchFulfillments',\n      'countFulfillments',\n      'exportFulfillments',\n    ]),\n\n    async fetch() {\n      this.isFetching = true\n      this.handleUpdateRouteQuery()\n\n      const result = await this.fetchFulfillments(this.filter)\n\n      if (!result.success) {\n        this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Server Error',\n        })\n      }\n\n      this.isFetching = false\n    },\n\n    changeDate(date) {\n      this.date = date\n\n      this.filter = {\n        ...this.filter,\n        create_start_date: date.startDate.toISOString().split('T')[0],\n        create_end_date: date.endDate.toISOString().split('T')[0],\n      }\n    },\n    async exportExcel() {\n      if (!this.filter.create_end_date || !this.filter.create_start_date) {\n        return this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Please choose the time to export',\n        })\n      }\n\n      const timePerDay = 24 * 60 * 60 * 1000\n      const endDate = new Date(this.filter.create_end_date)\n      const startDate = new Date(this.filter.create_start_date)\n      const days = (endDate - startDate) / timePerDay // 1 day\n\n      if (days > 7) {\n        return this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Export : Max 7 days',\n        })\n      }\n\n      this.handleUpdateRouteQuery()\n\n      const result = await this.exportFulfillments(this.filter)\n\n      this.exportFile(result, `fullfill-export.csv`, FULLFILL_EXPORT_BUCKET)\n    },\n  },\n  watch: {\n    filter: {\n      handler: function() {\n        this.fetch()\n      },\n      deep: true,\n    },\n  },\n}\n",null]}