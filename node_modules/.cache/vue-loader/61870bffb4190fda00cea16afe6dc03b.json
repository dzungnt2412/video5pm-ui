{"remainingRequest":"/home/tiendzung/workspace/lionnix/lionnix-seller-v2/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/tiendzung/workspace/lionnix/lionnix-seller-v2/src/packages/design/views/Form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/tiendzung/workspace/lionnix/lionnix-seller-v2/src/packages/design/views/Form.vue","mtime":1603898990380},{"path":"/home/tiendzung/workspace/lionnix/lionnix-seller-v2/node_modules/cache-loader/dist/cjs.js","mtime":1601450297498},{"path":"/home/tiendzung/workspace/lionnix/lionnix-seller-v2/node_modules/babel-loader/lib/index.js","mtime":1597736171393},{"path":"/home/tiendzung/workspace/lionnix/lionnix-seller-v2/node_modules/cache-loader/dist/cjs.js","mtime":1601450297498},{"path":"/home/tiendzung/workspace/lionnix/lionnix-seller-v2/node_modules/vue-loader/lib/index.js","mtime":1597736282333}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/*eslint-disable*/\nimport { mapActions, mapState } from 'vuex'\nimport mixinUpload from '@/core/mixins/upload'\nimport Thumbnail from '@components/shared/Thumbnail'\nimport mixinCreateDesign from '../mixins/create-design'\nimport { Upload } from '@kit'\nimport { MAX_DESIGN_FILE } from '@core/constants'\nimport {\n  CREATE_DESIGN,\n  FETCH_DESIGN,\n  FETCH_DESIGNS,\n  UPDATE_DESIGN,\n  DELETE_DESIGN,\n  UPDATE_DESIGN_SKU,\n  DELETE_DESIGN_FILES,\n  DOWNLOAD_DESIGN,\n} from '../store'\nimport ModalCreateDesign from './components/ModalCreateDesign'\nimport { cloneDeep } from '@core/utils'\nimport Browser from '@core/helpers/browser'\nimport designApi from '../api'\nimport ProductTypeResource from '@/components/shared/resource/ProductType'\nimport AuthService from '@core/services/auth'\n\nexport default {\n  name: 'DesignForm',\n  mixins: [mixinUpload, mixinCreateDesign],\n  components: { Thumbnail, Upload, ModalCreateDesign, ProductTypeResource },\n  computed: {\n    ...mapState('design', {\n      currentDesign: (state) => state.design,\n      currentDesignFiles: (state) => state.design.design_files,\n    }),\n    ...mapState('shared', {\n      productBases: (state) => state.productBases,\n    }),\n    validFiles() {\n      return this.files.filter(\n        ({ uid }) => this.uploadedIds.indexOf(uid) === -1\n      )\n    },\n    userInformation() {\n      if (this.design && this.design.user) {\n        return [\n          this.design.user.full_name,\n          this.design.user.username,\n          this.design.user.email,\n          this.design.user.phone,\n        ].filter(Boolean)\n      }\n      return []\n    },\n  },\n  data() {\n    return {\n      design: {\n        sku: '',\n        files: [],\n      },\n      productNames: {},\n      files: [],\n      preview: [],\n      isFetching: false,\n      isSaving: false,\n      isChange: false,\n      uploadReady: true,\n      uploadedIds: [],\n      isChangeSku: false,\n      changeProductIds: [],\n      designFiles: [],\n      isLoading: false,\n      showBtnSave: false,\n      disableUpload: false,\n    }\n  },\n  mounted() {\n    this.handleBeforeLeave()\n  },\n  methods: {\n    ...mapActions('design', [\n      FETCH_DESIGN,\n      UPDATE_DESIGN,\n      DELETE_DESIGN,\n      UPDATE_DESIGN_SKU,\n      DELETE_DESIGN_FILES,\n      DOWNLOAD_DESIGN,\n    ]),\n    async init() {\n      this.isFetching = true\n      if (this.$route.params.id) {\n        await this.getDesign()\n      }\n      this.isFetching = false\n    },\n    async getDesign() {\n      const id = parseInt(this.$route.params.id, 10)\n      const result = await this.fetchDesign(id)\n      this.isChange = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.design = cloneDeep(this.currentDesign)\n      this.designFiles = cloneDeep(this.currentDesign.design_files)\n      if (this.designFiles.length) {\n        this.showBtnSave = true\n      }\n    },\n\n    async handleSave() {\n      this.isSaving = true\n\n      const payload = {\n        id: this.design.id,\n        body: {\n          design_files: this.changeProductIds,\n        },\n      }\n\n      const result = await this.updateDesign(payload)\n      this.isSaving = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.$toast.open({ type: 'success', message: 'Update design successful' })\n      this.isChange = false\n      this.init()\n    },\n\n    handleDiscard() {},\n\n    beforeUpload() {\n      if (this.designFiles.length >= MAX_DESIGN_FILE) {\n        this.$toast.open({\n          type: 'error',\n          message: `Design can not upload more than ${MAX_DESIGN_FILE} file`,\n        })\n        this.disableUpload = true\n        return false\n      }\n\n      this.isChange = true\n      return true\n    },\n    handleChangeFile(file) {\n      if (this.disableUpload) {\n        return\n      }\n\n      const index = this.files.findIndex(({ uid }) => uid === file.uid)\n      if (index === -1) {\n        this.files.push(file)\n      } else {\n        this.$set(this.files, index, file)\n      }\n    },\n\n    handleSuccess(val, file) {\n      if (val && typeof val.design_file !== 'undefined') {\n        this.designFiles.push(val.design_file)\n      }\n      this.showBtnSave = true\n    },\n\n    showDeleteConfirmation(item) {\n      this.$dialog.confirm({\n        title: `Remove design file?`,\n        message: `Are you sure you want to remove this design file?`,\n        confirmText: 'Remove',\n        onConfirm: () => this.handleDelete(item),\n        type: 'danger',\n      })\n    },\n\n    async handleDelete(item) {\n      this.isSaving = true\n\n      const payload = {\n        id: item.id,\n        design_id: item.design_id,\n      }\n      const result = await this.deleteDesignFile(payload)\n      this.isSaving = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.isChange = true\n      this.$toast.open({\n        type: 'success',\n        message: 'Delete design file successful',\n      })\n      this.designFiles = this.designFiles.filter((x) => x !== item)\n      if (this.designFiles.length === 0) {\n        this.showBtnSave = false\n      }\n    },\n\n    handleBeforeLeave() {\n      window.onbeforeunload = function() {\n        if (this.isChange) {\n          return 'If you leave this page, all unsaved changes will be lost. Are you sure you want to leave this page?'\n        }\n\n        return null\n      }.bind(this)\n    },\n\n    async handlerChangeSku() {\n      this.isSaving = true\n      const payload = {\n        id: this.design.id,\n        sku: this.design.sku,\n      }\n      const result = await this.updateDesignSku(payload)\n      this.isSaving = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.isChangeSku = false\n      this.$toast.open({\n        type: 'success',\n        message: 'Update design sku successful',\n      })\n    },\n\n    async handleDownloadFile(id) {\n      this.isLoading = true\n      const url = `${\n        process.env.VUE_APP_BASE_API_ENDPOINT\n      }/designs/files/${id}/download?access_token=${AuthService.getAccessToken()}`\n      window.open(url, '_self')\n      this.isLoading = false\n    },\n\n    async handleCreateZipDesign() {\n      this.isSaving = true\n      const payload = {\n        id: this.design.id,\n        sku: this.design.sku,\n      }\n      const result = await this.updateDesignSku(payload)\n      this.isSaving = false\n      this.isChange = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: 'Update design failed !' })\n        return\n      }\n\n      this.$toast.open({ type: 'success', message: 'Update design success !' })\n      this.isChangeSku = false\n      this.init()\n    },\n\n    async handlerDeleteDesign() {\n      if (this.design.design_files && this.design.design_files.length > 0) {\n        this.$toast.open({\n          type: 'error',\n          message: 'Cant delete design contains the file',\n        })\n        return\n      }\n\n      this.isSaving = true\n      const payload = {\n        id: this.design.id,\n      }\n\n      const result = await this.deleteDesign(payload)\n      this.isSaving = false\n\n      if (result.success) {\n        this.$toast.open('Delete design successful')\n        this.$router.push({ name: 'design-list' })\n        return\n      }\n\n      this.$toast.open({ type: 'error', message: result.message })\n    },\n\n    showConfirmDeleteDesign() {\n      this.$dialog.confirm({\n        title: `Delete design?`,\n        message: `Are you sure you want to delete this design?`,\n        confirmText: 'Delete',\n        onConfirm: () => this.handlerDeleteDesign(),\n        type: 'danger',\n      })\n    },\n\n    handlerCancelChangeSku() {\n      this.isChangeSku = false\n      this.design.sku = this.currentDesign.sku\n    },\n  },\n  watch: {\n    '$route.params.id': {\n      handler: function() {\n        this.init()\n      },\n      immediate: true,\n    },\n  },\n  beforeRouteLeave(to, from, next) {\n    if (this.isChange) {\n      if (\n        !window.confirm(\n          'If you leave this page, all unsaved changes will be lost. Are you sure you want to leave this page?'\n        )\n      ) {\n        return\n      }\n    }\n\n    next()\n  },\n}\n",{"version":3,"sources":["Form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Form.vue","sourceRoot":"src/packages/design/views","sourcesContent":["<template>\n  <PageDetailLoading v-if=\"isFetching\"></PageDetailLoading>\n  <div class=\"page\" v-else>\n    <div class=\"page-header pb-0\">\n      <div class=\"row\">\n        <div class=\"col-12\">\n          <p-button icon=\"chevron-left\" class=\"btn-pure pl-0\">\n            <router-link :to=\"{ name: 'design-list' }\">Designs</router-link>\n          </p-button>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div\n          class=\"col-12  d-flex align-items-center justify-content-between mb-20\"\n        >\n          <h4>\n            Update Design\n            <span v-if=\"design && !isChangeSku\">\n              : {{ design.sku }}\n              <a href=\"#\" @click=\"isChangeSku = !isChangeSku\"\n                ><p-icon name=\"edit\" iconPack=\"md\"></p-icon\n              ></a>\n            </span>\n            <div style=\"display: inline-block;\">\n              <div\n                v-if=\"design && isChangeSku\"\n                class=\"input-group input-group-sm\"\n              >\n                <input\n                  type=\"text\"\n                  class=\"form-control\"\n                  v-model=\"design.sku\"\n                  v-validate=\"'required|min:3'\"\n                />\n                <div class=\"input-group-btn\">\n                  <p-button\n                    :type=\"'primary'\"\n                    :disabled=\"isSaving\"\n                    :loading=\"isSaving || isLoading\"\n                    :size=\"'sm'\"\n                    @click=\"handlerChangeSku\"\n                    >Ok</p-button\n                  >\n                  <button\n                    class=\"btn btn-sm btn-danger\"\n                    @click=\"handlerCancelChangeSku\"\n                    :loading=\"isLoading\"\n                    >Cancel</button\n                  >\n                </div>\n              </div>\n            </div>\n          </h4>\n          <div class=\"page-header-group-actions__left\">\n            <p-button\n              :type=\"'primary'\"\n              class=\"ml-10\"\n              v-if=\"design.status == 1 || isChange\"\n              @click.prevent=\"handleCreateZipDesign\"\n            >\n              Lựu lại\n            </p-button>\n            <p-button\n              :type=\"'danger'\"\n              class=\"ml-10\"\n              @click.prevent=\"showConfirmDeleteDesign\"\n            >\n              Xóa\n            </p-button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"page-content container-fluid\">\n      <div class=\"row\">\n        <div class=\"col-12 col-md-8\">\n          <div class=\"card\">\n            <div class=\"card-block\">\n              <div class=\"card-title\">\n                <h4>\n                  Design Files\n                </h4>\n              </div>\n              <div v-if=\"isFetching\" class=\"text-center mb-50 mt-50\">\n                <div class=\"loader vertical-align-middle loader-circle\"></div>\n              </div>\n              <div\n                class=\"gallery row\"\n                v-else-if=\"designFiles && designFiles.length\"\n              >\n                <div\n                  class=\"col-6 col-sm-4\"\n                  v-for=\"(item, i) in designFiles\"\n                  :key=\"i\"\n                >\n                  <div class=\"gallery-item\">\n                    <thumbnail :src=\"item.url\" />\n                    <template v-if=\"!item.is_edit\">\n                      <div class=\"gallery-item__actions\">\n                        <a\n                          href=\"#\"\n                          @click.prevent=\"handleDownloadFile(item.id)\"\n                          class=\"ml-5\"\n                        >\n                          <p-icon name=\"download\" icon-pack=\"md\"></p-icon>\n                        </a>\n                        <a\n                          href=\"#\"\n                          @click.prevent=\"showDeleteConfirmation(item)\"\n                          class=\"ml-5\"\n                        >\n                          <p-icon\n                            name=\"close\"\n                            icon-pack=\"md\"\n                            @click.prevent=\"showDeleteConfirmation(item)\"\n                          ></p-icon>\n                        </a>\n                      </div>\n                    </template>\n                  </div>\n                </div>\n              </div>\n              <div class=\"text-center mt-40 mb-40\" v-else>\n                <svg\n                  width=\"192\"\n                  height=\"135\"\n                  viewBox=\"0 0 192 128\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                >\n                  <g fill=\"none\">\n                    <path\n                      fill=\"#E9EBED\"\n                      d=\"M138.049 43.407L95.873 33.248v79.494l42.176-11.04z\"\n                    ></path>\n                    <path\n                      fill=\"#DFE0E2\"\n                      d=\"M53.696 43.407l42.177-10.159v79.494l-42.177-10.82z\"\n                    ></path>\n                    <path\n                      fill=\"#F5F6F7\"\n                      d=\"M95.52 33.6l22.214-18.459 42.174 10.822-22.211 17.794z\"\n                    ></path>\n                    <path\n                      fill=\"#E0E0E0\"\n                      d=\"M32.408 26.534l21.64 17.223 42.175-10.156-21.418-18.107z\"\n                    ></path>\n                    <path\n                      fill=\"#EEF0F1\"\n                      d=\"M32.058 26.184l22.166 17.573L96.4 33.601 74.453 15.14z\"\n                    ></path>\n                    <path\n                      fill=\"#E9EBED\"\n                      d=\"M53.696 43.407v58.516l42.177 10.819.569-58.074z\"\n                    ></path>\n                    <path\n                      fill=\"#DFE0E2\"\n                      d=\"M138.049 101.702l-42.176 11.04V54.668l42.176-11.261z\"\n                    ></path>\n                    <path\n                      fill=\"#000\"\n                      opacity=\".06\"\n                      d=\"M121.266 82.269v19.212l16.783-4.639v-19.21z\"\n                    ></path>\n                    <path\n                      fill=\"#000\"\n                      opacity=\".04\"\n                      d=\"M53.145 73.769l23.627 5.962 18.991-15.458v-9.495L53.587 44.179z\"\n                    ></path>\n                    <path\n                      fill=\"#000\"\n                      opacity=\".04\"\n                      d=\"M138.38 73.769l-23.628 5.962-18.989-15.458v-9.495l42.174-10.599z\"\n                    ></path>\n                    <path\n                      fill=\"#F5F6F7\"\n                      d=\"M53.696 43.407L32.058 61.293l42.174 10.598 21.64-17.223z\"\n                    ></path>\n                    <path\n                      fill=\"#E0E0E0\"\n                      d=\"M138.049 43.407l21.86 17.886-41.956 10.598-22.08-17.223z\"\n                    ></path>\n                    <path\n                      fill=\"#EEF0F1\"\n                      d=\"M138.049 43.407l21.86 17.886-41.956 10.598-22.08-17.223z\"\n                    ></path>\n                  </g>\n                </svg>\n                <p>\n                  No design files have been uploaded yet\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"col-12 col-md-4\">\n          <section class=\"card\">\n            <div class=\"card-block\">\n              <div class=\"card-title\">\n                <h4>\n                  Upload\n                </h4>\n              </div>\n\n              <upload\n                class=\"design-uploader\"\n                :action=\"createEndpoint(`designs/${$route.params.id}/files`)\"\n                drag\n                multiple\n                list-type=\"picture\"\n                :headers=\"uploadHeaders\"\n                :on-change=\"handleChangeFile\"\n                :on-success=\"handleSuccess\"\n                :max-file-size=\"100000000\"\n                :before-upload=\"beforeUpload\"\n              >\n                <p-icon\n                  name=\"cloud-upload\"\n                  icon-pack=\"md\"\n                  class=\"el-icon-upload\"\n                ></p-icon>\n                <div class=\"el-upload__text\">\n                  Drop file here or <em>click to upload</em>\n                </div>\n              </upload>\n              <div class=\"el-upload__tip\"\n                >jpg/png files with a size less than 100mb</div\n              >\n              <div class=\"gallery-list\">\n                <div\n                  class=\"gallery-list__item\"\n                  v-for=\"(item, i) in validFiles\"\n                  :key=\"i\"\n                >\n                  <div class=\"gallery-list__item-top\">\n                    <div class=\"gallery-list__item-group\">\n                      <div class=\"gallery-list__item-group--thumbnail\">\n                        <img :src=\"item.url\" alt=\"Preview\" v-if=\"item.url\" />\n                        <p-icon v-else name=\"image\" icon-pack=\"md\"></p-icon>\n                      </div>\n                      <p>{{ item.name }}</p>\n                    </div>\n                    <div\n                      class=\"gallery-list__item-label\"\n                      v-if=\"item.status === 'fail'\"\n                    >\n                      <span>Error</span>\n                    </div>\n                  </div>\n\n                  <div\n                    class=\"gallery-list__item-bottom\"\n                    v-if=\"item.percentage && item.status !== 'fail'\"\n                  >\n                    <p-progress\n                      :value=\"item.percentage\"\n                      show-value\n                      format=\"percent\"\n                      type=\"primary\"\n                    ></p-progress>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>\n          <section\n            class=\"card\"\n            v-if=\"userInformation && userInformation.length\"\n          >\n            <div class=\"card-block\">\n              <div class=\"card-title\">\n                <h4>\n                  User information\n                </h4>\n              </div>\n              <p class=\"card-text\">\n                <span v-for=\"(item, i) in userInformation\" :key=\"i\">\n                  {{ item }}\n                  <br />\n                </span>\n              </p>\n            </div>\n          </section>\n        </div>\n      </div>\n    </div>\n\n    <modal-create-design\n      :visible.sync=\"isVisibleCreateDesign\"\n      :create-design=\"createDesign\"\n      v-if=\"isVisibleCreateDesign\"\n      @created=\"handleCreateDesignDesign\"\n    />\n  </div>\n</template>\n<script>\n/*eslint-disable*/\nimport { mapActions, mapState } from 'vuex'\nimport mixinUpload from '@/core/mixins/upload'\nimport Thumbnail from '@components/shared/Thumbnail'\nimport mixinCreateDesign from '../mixins/create-design'\nimport { Upload } from '@kit'\nimport { MAX_DESIGN_FILE } from '@core/constants'\nimport {\n  CREATE_DESIGN,\n  FETCH_DESIGN,\n  FETCH_DESIGNS,\n  UPDATE_DESIGN,\n  DELETE_DESIGN,\n  UPDATE_DESIGN_SKU,\n  DELETE_DESIGN_FILES,\n  DOWNLOAD_DESIGN,\n} from '../store'\nimport ModalCreateDesign from './components/ModalCreateDesign'\nimport { cloneDeep } from '@core/utils'\nimport Browser from '@core/helpers/browser'\nimport designApi from '../api'\nimport ProductTypeResource from '@/components/shared/resource/ProductType'\nimport AuthService from '@core/services/auth'\n\nexport default {\n  name: 'DesignForm',\n  mixins: [mixinUpload, mixinCreateDesign],\n  components: { Thumbnail, Upload, ModalCreateDesign, ProductTypeResource },\n  computed: {\n    ...mapState('design', {\n      currentDesign: (state) => state.design,\n      currentDesignFiles: (state) => state.design.design_files,\n    }),\n    ...mapState('shared', {\n      productBases: (state) => state.productBases,\n    }),\n    validFiles() {\n      return this.files.filter(\n        ({ uid }) => this.uploadedIds.indexOf(uid) === -1\n      )\n    },\n    userInformation() {\n      if (this.design && this.design.user) {\n        return [\n          this.design.user.full_name,\n          this.design.user.username,\n          this.design.user.email,\n          this.design.user.phone,\n        ].filter(Boolean)\n      }\n      return []\n    },\n  },\n  data() {\n    return {\n      design: {\n        sku: '',\n        files: [],\n      },\n      productNames: {},\n      files: [],\n      preview: [],\n      isFetching: false,\n      isSaving: false,\n      isChange: false,\n      uploadReady: true,\n      uploadedIds: [],\n      isChangeSku: false,\n      changeProductIds: [],\n      designFiles: [],\n      isLoading: false,\n      showBtnSave: false,\n      disableUpload: false,\n    }\n  },\n  mounted() {\n    this.handleBeforeLeave()\n  },\n  methods: {\n    ...mapActions('design', [\n      FETCH_DESIGN,\n      UPDATE_DESIGN,\n      DELETE_DESIGN,\n      UPDATE_DESIGN_SKU,\n      DELETE_DESIGN_FILES,\n      DOWNLOAD_DESIGN,\n    ]),\n    async init() {\n      this.isFetching = true\n      if (this.$route.params.id) {\n        await this.getDesign()\n      }\n      this.isFetching = false\n    },\n    async getDesign() {\n      const id = parseInt(this.$route.params.id, 10)\n      const result = await this.fetchDesign(id)\n      this.isChange = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.design = cloneDeep(this.currentDesign)\n      this.designFiles = cloneDeep(this.currentDesign.design_files)\n      if (this.designFiles.length) {\n        this.showBtnSave = true\n      }\n    },\n\n    async handleSave() {\n      this.isSaving = true\n\n      const payload = {\n        id: this.design.id,\n        body: {\n          design_files: this.changeProductIds,\n        },\n      }\n\n      const result = await this.updateDesign(payload)\n      this.isSaving = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.$toast.open({ type: 'success', message: 'Update design successful' })\n      this.isChange = false\n      this.init()\n    },\n\n    handleDiscard() {},\n\n    beforeUpload() {\n      if (this.designFiles.length >= MAX_DESIGN_FILE) {\n        this.$toast.open({\n          type: 'error',\n          message: `Design can not upload more than ${MAX_DESIGN_FILE} file`,\n        })\n        this.disableUpload = true\n        return false\n      }\n\n      this.isChange = true\n      return true\n    },\n    handleChangeFile(file) {\n      if (this.disableUpload) {\n        return\n      }\n\n      const index = this.files.findIndex(({ uid }) => uid === file.uid)\n      if (index === -1) {\n        this.files.push(file)\n      } else {\n        this.$set(this.files, index, file)\n      }\n    },\n\n    handleSuccess(val, file) {\n      if (val && typeof val.design_file !== 'undefined') {\n        this.designFiles.push(val.design_file)\n      }\n      this.showBtnSave = true\n    },\n\n    showDeleteConfirmation(item) {\n      this.$dialog.confirm({\n        title: `Remove design file?`,\n        message: `Are you sure you want to remove this design file?`,\n        confirmText: 'Remove',\n        onConfirm: () => this.handleDelete(item),\n        type: 'danger',\n      })\n    },\n\n    async handleDelete(item) {\n      this.isSaving = true\n\n      const payload = {\n        id: item.id,\n        design_id: item.design_id,\n      }\n      const result = await this.deleteDesignFile(payload)\n      this.isSaving = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.isChange = true\n      this.$toast.open({\n        type: 'success',\n        message: 'Delete design file successful',\n      })\n      this.designFiles = this.designFiles.filter((x) => x !== item)\n      if (this.designFiles.length === 0) {\n        this.showBtnSave = false\n      }\n    },\n\n    handleBeforeLeave() {\n      window.onbeforeunload = function() {\n        if (this.isChange) {\n          return 'If you leave this page, all unsaved changes will be lost. Are you sure you want to leave this page?'\n        }\n\n        return null\n      }.bind(this)\n    },\n\n    async handlerChangeSku() {\n      this.isSaving = true\n      const payload = {\n        id: this.design.id,\n        sku: this.design.sku,\n      }\n      const result = await this.updateDesignSku(payload)\n      this.isSaving = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: result.message })\n        return\n      }\n\n      this.isChangeSku = false\n      this.$toast.open({\n        type: 'success',\n        message: 'Update design sku successful',\n      })\n    },\n\n    async handleDownloadFile(id) {\n      this.isLoading = true\n      const url = `${\n        process.env.VUE_APP_BASE_API_ENDPOINT\n      }/designs/files/${id}/download?access_token=${AuthService.getAccessToken()}`\n      window.open(url, '_self')\n      this.isLoading = false\n    },\n\n    async handleCreateZipDesign() {\n      this.isSaving = true\n      const payload = {\n        id: this.design.id,\n        sku: this.design.sku,\n      }\n      const result = await this.updateDesignSku(payload)\n      this.isSaving = false\n      this.isChange = false\n\n      if (!result.success) {\n        this.$toast.open({ type: 'error', message: 'Update design failed !' })\n        return\n      }\n\n      this.$toast.open({ type: 'success', message: 'Update design success !' })\n      this.isChangeSku = false\n      this.init()\n    },\n\n    async handlerDeleteDesign() {\n      if (this.design.design_files && this.design.design_files.length > 0) {\n        this.$toast.open({\n          type: 'error',\n          message: 'Cant delete design contains the file',\n        })\n        return\n      }\n\n      this.isSaving = true\n      const payload = {\n        id: this.design.id,\n      }\n\n      const result = await this.deleteDesign(payload)\n      this.isSaving = false\n\n      if (result.success) {\n        this.$toast.open('Delete design successful')\n        this.$router.push({ name: 'design-list' })\n        return\n      }\n\n      this.$toast.open({ type: 'error', message: result.message })\n    },\n\n    showConfirmDeleteDesign() {\n      this.$dialog.confirm({\n        title: `Delete design?`,\n        message: `Are you sure you want to delete this design?`,\n        confirmText: 'Delete',\n        onConfirm: () => this.handlerDeleteDesign(),\n        type: 'danger',\n      })\n    },\n\n    handlerCancelChangeSku() {\n      this.isChangeSku = false\n      this.design.sku = this.currentDesign.sku\n    },\n  },\n  watch: {\n    '$route.params.id': {\n      handler: function() {\n        this.init()\n      },\n      immediate: true,\n    },\n  },\n  beforeRouteLeave(to, from, next) {\n    if (this.isChange) {\n      if (\n        !window.confirm(\n          'If you leave this page, all unsaved changes will be lost. Are you sure you want to leave this page?'\n        )\n      ) {\n        return\n      }\n    }\n\n    next()\n  },\n}\n</script>\n<style scoped>\n.gallery-item__label {\n  top: 10px;\n  left: 10px;\n  color: #ffff;\n  cursor: pointer;\n  font-weight: bold;\n  font-size: 15px;\n  opacity: 1;\n}\n.mutiple-search {\n  z-index: 4;\n  position: absolute;\n  top: 0;\n}\n.multiselect.multiselect-custom {\n  width: 100%;\n}\n</style>\n<style>\n.multiselect__tags {\n  border-radius: 0 !important;\n}\n</style>\n"]}]}