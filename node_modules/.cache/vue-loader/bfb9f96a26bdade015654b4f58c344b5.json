{"remainingRequest":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/tiendzung/workspace/video5pm/video5pm-ui/src/packages/fulfillment/views/List.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/src/packages/fulfillment/views/List.vue","mtime":1603898990380},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/cache-loader/dist/cjs.js","mtime":1601450297498},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/babel-loader/lib/index.js","mtime":1597736171393},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/cache-loader/dist/cjs.js","mtime":1601450297498},{"path":"/home/tiendzung/workspace/video5pm/video5pm-ui/node_modules/vue-loader/lib/index.js","mtime":1597736282333}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport EmptySearchResult from '@components/shared/EmptySearchResult'\nimport { mapState, mapActions } from 'vuex'\nimport mixinRoute from '@core/mixins/route'\nimport { VclTable } from 'vue-content-loading'\nimport mixinTable from '@core/mixins/table'\nimport mixinExportOrder from '@/packages/container/mixins/export-file'\nimport { FULLFILL_EXPORT_BUCKET } from '@core/constants/storage'\nexport default {\n  name: 'FulfillmentList',\n  mixins: [mixinRoute, mixinTable, mixinExportOrder],\n  components: {\n    EmptySearchResult,\n    VclTable,\n  },\n  data: () => ({\n    isFetching: false,\n    filter: {\n      page: 1,\n      search: '',\n      limit: 50,\n      user_id: 0,\n    },\n  }),\n  computed: {\n    ...mapState('fulfillment', {\n      fulfillments: (state) => state.fulfillments,\n      count: (state) => state.count,\n      download: (state) => state.download,\n    }),\n  },\n  created() {\n    this.filter = this.getRouteQuery()\n\n    this.fetch()\n  },\n  methods: {\n    ...mapActions('fulfillment', [\n      'fetchFulfillments',\n      'countFulfillments',\n      'exportFulfillments',\n    ]),\n\n    async fetch() {\n      this.isFetching = true\n      this.handleUpdateRouteQuery()\n\n      const result = await this.fetchFulfillments(this.filter)\n\n      if (!result.success) {\n        this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Server Error',\n        })\n      }\n\n      this.isFetching = false\n    },\n\n    changeDate(date) {\n      this.date = date\n\n      this.filter = {\n        ...this.filter,\n        create_start_date: date.startDate.toISOString().split('T')[0],\n        create_end_date: date.endDate.toISOString().split('T')[0],\n      }\n    },\n    async exportExcel() {\n      if (!this.filter.create_end_date || !this.filter.create_start_date) {\n        return this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Please choose the time to export',\n        })\n      }\n\n      const timePerDay = 24 * 60 * 60 * 1000\n      const endDate = new Date(this.filter.create_end_date)\n      const startDate = new Date(this.filter.create_start_date)\n      const days = (endDate - startDate) / timePerDay // 1 day\n\n      if (days > 7) {\n        return this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Export : Max 7 days',\n        })\n      }\n\n      this.handleUpdateRouteQuery()\n\n      const result = await this.exportFulfillments(this.filter)\n\n      this.exportFile(result, `fullfill-export.csv`, FULLFILL_EXPORT_BUCKET)\n    },\n  },\n  watch: {\n    filter: {\n      handler: function() {\n        this.fetch()\n      },\n      deep: true,\n    },\n  },\n}\n",{"version":3,"sources":["List.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"List.vue","sourceRoot":"src/packages/fulfillment/views","sourcesContent":["<template>\n  <div class=\"page\">\n    <div class=\"page-content\">\n      <button\n        class=\"btn btn-primary mb-25 mr-25 float-right\"\n        @click=\"exportExcel\"\n        >Export</button\n      >\n      <div style=\"clear:both\"></div>\n      <div class=\"row\">\n        <div class=\"col-11\">\n          <p-datepicker\n            placeholder=\"Tìm kiếm ticket theo Mã đơn hàng/Tiêu đề\"\n            prefixIcon=\"search\"\n            class=\"mb-2 taf\"\n            type=\"search\"\n            style=\"width:100%\"\n            @update=\"changeDate\"\n          ></p-datepicker>\n        </div>\n        <div class=\"col-1\">\n          <p-button icon=\"search\" @click=\"fetch\">Search</p-button>\n        </div>\n      </div>\n    </div>\n    <div class=\"page-content container-fluid\">\n      <div class=\"row\">\n        <div class=\"col-xl-12\">\n          <VclTable class=\"my-20\" v-if=\"isFetching\"></VclTable>\n          <template v-else-if=\"fulfillments.length\">\n            <div class=\"table-responsive-xl\">\n              <table class=\"table table-hover table-border\">\n                <thead>\n                  <tr>\n                    <th>Order Number</th>\n                    <th>Tracking Company</th>\n                    <th>Tracking Number</th>\n                    <th>Tracking URL</th>\n                    <th class=\"text-right\">Date</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"(item, index) in fulfillments\" :key=\"index\">\n                    <td>{{ item.order ? item.order.ref_id : '' }}</td>\n                    <td>{{ item.tracking_company }}</td>\n                    <td>{{ item.tracking_number }}</td>\n                    <td>\n                      <a :href=\"item.tracking_url\" target=\"_blank\">\n                        {{ item.tracking_url }}\n                      </a>\n                    </td>\n                    <td class=\"text-right\">{{\n                      item.created_at | datetime('dd/MM/yyyy HH:mm')\n                    }}</td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n            <div class=\"d-flex justify-content-between align-items-center\">\n              <span>{{ paginationLabel }}</span>\n              <p-pagination\n                :total=\"count\"\n                :perPage=\"filter.limit\"\n                :current.sync=\"filter.page\"\n                size=\"sm\"\n              ></p-pagination>\n            </div>\n          </template>\n          <EmptySearchResult\n            v-else\n            title=\"Không tìm thấy fulfillment\"\n          ></EmptySearchResult>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport EmptySearchResult from '@components/shared/EmptySearchResult'\nimport { mapState, mapActions } from 'vuex'\nimport mixinRoute from '@core/mixins/route'\nimport { VclTable } from 'vue-content-loading'\nimport mixinTable from '@core/mixins/table'\nimport mixinExportOrder from '@/packages/container/mixins/export-file'\nimport { FULLFILL_EXPORT_BUCKET } from '@core/constants/storage'\nexport default {\n  name: 'FulfillmentList',\n  mixins: [mixinRoute, mixinTable, mixinExportOrder],\n  components: {\n    EmptySearchResult,\n    VclTable,\n  },\n  data: () => ({\n    isFetching: false,\n    filter: {\n      page: 1,\n      search: '',\n      limit: 50,\n      user_id: 0,\n    },\n  }),\n  computed: {\n    ...mapState('fulfillment', {\n      fulfillments: (state) => state.fulfillments,\n      count: (state) => state.count,\n      download: (state) => state.download,\n    }),\n  },\n  created() {\n    this.filter = this.getRouteQuery()\n\n    this.fetch()\n  },\n  methods: {\n    ...mapActions('fulfillment', [\n      'fetchFulfillments',\n      'countFulfillments',\n      'exportFulfillments',\n    ]),\n\n    async fetch() {\n      this.isFetching = true\n      this.handleUpdateRouteQuery()\n\n      const result = await this.fetchFulfillments(this.filter)\n\n      if (!result.success) {\n        this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Server Error',\n        })\n      }\n\n      this.isFetching = false\n    },\n\n    changeDate(date) {\n      this.date = date\n\n      this.filter = {\n        ...this.filter,\n        create_start_date: date.startDate.toISOString().split('T')[0],\n        create_end_date: date.endDate.toISOString().split('T')[0],\n      }\n    },\n    async exportExcel() {\n      if (!this.filter.create_end_date || !this.filter.create_start_date) {\n        return this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Please choose the time to export',\n        })\n      }\n\n      const timePerDay = 24 * 60 * 60 * 1000\n      const endDate = new Date(this.filter.create_end_date)\n      const startDate = new Date(this.filter.create_start_date)\n      const days = (endDate - startDate) / timePerDay // 1 day\n\n      if (days > 7) {\n        return this.$notify({\n          title: 'Alert',\n          type: 'error',\n          text: 'Export : Max 7 days',\n        })\n      }\n\n      this.handleUpdateRouteQuery()\n\n      const result = await this.exportFulfillments(this.filter)\n\n      this.exportFile(result, `fullfill-export.csv`, FULLFILL_EXPORT_BUCKET)\n    },\n  },\n  watch: {\n    filter: {\n      handler: function() {\n        this.fetch()\n      },\n      deep: true,\n    },\n  },\n}\n</script>\n"]}]}